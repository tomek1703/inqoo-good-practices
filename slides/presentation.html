<!DOCTYPE html>
<html>
<head>
    <title>Dobre praktyki tworzenia oprogramowania</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Arial);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);
      body { font-family: 'Arial'; }
      h1, h2, h3 {
        font-family: 'Arial';
        font-weight: normal;
      }
      .inverse {
        color: white;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }
      .footnote {
        position: absolute;
        bottom: 3em;
      }
      /* Two-column layout */
      .left-column {
        width: 45%;
        height: 92%;
        float: left;
        padding-right: 1em;
      }
      .left-column h2:last-of-type, .left-column h3:last-child {
        color: #000;
      }
      .right-column {
        width: 45%;
        float: right;
        padding-left: 1em;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
</head>
<body>
<textarea id="source">

name: inverse
layout: true
class: inverse

---
layout: false
class: center middle

# Dobre praktyki tworzenia oprogramowania

---
layout: false

## Kim jestem

W IT od nastu lat

W INQOO mentor kursu

Poza tym programista, częściowo architekt, czasem trener, sporadycznie prelegent

Specjalizacja: TDD, BDD, DDD, Agile Software Development

Członek rady programowej Silesia JUG
---
## Kontrakt

W czasie warsztatów nie ma sztywnych przerw

Będzie zadanie domowe - miniprojekt

Nie rozumiemy - przerywamy i pytamy

Jeśli jest za szybko/cicho - dajecie mi znać

Przerwa obiadowa?

---
## Gdzie jesteśmy i po co to szkolenie

Były podstawy na preworku

Znamy składnie dwóch języków (znamy?)

Czy to wystarczy?

---

## Program szkolenia

Jakość

Czysty kod

Zespołowość

TDD

Object callisthenics

---

layout: false
class: center middle

## Jakość

---

## Jakość w ogóle

Co to dla Was jest?

Skąd wiecie że Wasza obecna praca ma właściwą jakość?

---

## Jakość w programowaniu

Po czym poznajecie, że Wasz program jest dobrej jakości?

---

layout: false
class: center middle

## Jakość z perspektywy użytkownika

---

## Aspekty

Dostępność

Funkcje

Poprawność działania

---

layout: false
class: center middle

## Jakość z perspektywy użytkownika - czyli co?

---

layout: false
class: center middle

## Jakość z perspektywy użytkownika - czyli co?
### Spełnione oczekiwania klientów

---

## Sposoby zapewnienia

Testy automatyczne

Testy ręczne

Testy wydajnościowe

Monitoring działającego systemu

---
layout: false
class: center middle

## Jakość z perspektywy programistów

---
## Jakość z perspektywy programistów

Czy mieliście wrażenie, że kod Waszego programu przeszkadza Wam w programowaniu?

---

## Aspekty

Łatwe wprowadzanie nowych funkcji

Łatwe poprawianie błędów

Łatwość dostarczania ww. zmian klientowi

Łatwość wdrożenia nowych programistów

---
layout: false
class: center middle

## Jakość z perspektywy programistów - czyli co?


---

layout: false
class: center middle

## Jakość z perspektywy programistów - czyli co?
### System tani w utrzymaniu!

---

## Sposoby zapewnienia (niektóre)

Testy automatyczne

Czytelny i zrozumiały kod źródłowy

Programowanie w parach (pair programming)

Przegląd kodu (code review)

---

layout: false
class: center middle

## Czysty kod (clean code)

Kod łatwy do zrozumienia i do zmiany

(czyli właściwie co?)

---

layout: false
class: center middle

## Zobaczmy to na przykładzie

---
## Ćwiczenie - czytelność kodu

Otwórz klasę `com.inqoo.quality.clean.example.bad.Calc`

Uważnie przeczytaj kod metody `calculate`

Co robi ta klasa? Jaka jest jej odpowiedzialność?

Zastanów się na ile łatwa do zrozumienia jest ta klasa

Wskaż co ułatwia Ci zrozumienie tego kodu, a co utrudnia

Co by pomogło Ci zrozumieć ten kod

Spróbuj

10 minut

---

## Ćwiczenie - czytelność kodu

Jak można ten kod poprawić?

Spróbujecie?

---
## Ćwiczenie - czytelność kodu

Otwórz klasę `com.inqoo.quality.clean.example.good.PITCalculator`

Uważnie przeczytaj kod metody `calculate`

Co robi ta klasa? Jaka jest jej odpowiedzialność?

Zastanów się na ile łatwa do zrozumienia jest ta klasa

Wskaż co ułatwia Ci zrozumienie tego kodu, a co utrudnia

Co by pomogło Ci zrozumieć ten kod

10 minut

---

## Ćwiczenie - wnioski

Który kod był bardziej czytelny?

Dlaczego?

Czy o którymś z nich można powiedzieć "idealny"?

---

## Czysty kod

Łatwy do zrozumienia

Samodokumentujący

"Czyta się jak książkę" - test Ivony

---

## Czysty kod

Zrozumiałe nazwy klas, metod i zmiennych

Budowa funkcji (metod)

Klasy

Komentarze

Formatowanie

Obsługa błędów

---

## Dobre nazwy

Zrozumiałe

Możliwie szczegółowe

Nadające sens

Mające znaczenie

Zmniejszają do minimum liczbę potrzebnych komentarzy

---

## Dobre nazwy

Klasy - najczęściej rzeczowniki
> np. Employee, Reader, Student, Doctor

Metody - najczęsciej czasowniki

> np. save, send, calculate

Zmienne - rzeczowniki

> Litera jako nazwa tylko jako licznik pętli, współrzędna punktu itp.

---
layout: false
class: center middle

## Dobre i złe nazwy - przykłady

---

## Wyrażanie intencji

### Źle

```
int d;
// elapsed time in days
// create ago days
int ds;
// modified agoe
int dsm;
// file age
int faid;
```

---
## Wyrażanie intencji

### Źle

```
int d;
// elapsed time in days
int ds;
int dsm;
int faid;
```

### Dobrze

```
int elapsedTimeInDays;
int daysSinceCreation;
int daysSinceModification;
int fileAgeInDays;
```
---
## Dezinformacja

### Źle

```
Customer[] customerList;
Table theTable;
```
---
## Dezinformacja

### Źle

```
Customer[] customerList;
Table theTable;
```

### Dobrze

```
Customer[] customers;
Table customers;
```
---

## Długość nazw

### Źle

```
List<Customer> theCustomersListWithAllCustomersIncludedWithoutFilter;
```
---

## Długość nazw

### Źle

```
List<Customer> theCustomersListWithAllCustomersIncludedWithoutFilter;
```

### Dobrze

```
List<Customer> allCustomers

```
---

## Spójność nazw

### Źle

```

void LoadSingleDataItem()
void FetchDataItemsFiltered()
void GetAllDataItems()

```
---

## Spójność nazw

### Źle

```

void LoadSingleDataItem()
void FetchDataItemsFiltered()
void GetAllDataItems()

```

### Dobrze

```

void GetSingleDataItem()
void GetDataItemsFiltered()
void GetAllDataItems()

```

---
## Nazwy dziedzinowe

### Źle
```
// prod and catetory
public class Relation {
    FirstEntity o1;
    SecondEntity o2;
}
```
---
## Nazwy dziedzinowe

### Źle
```
// prod and catetory
public class Relation {
    FirstEntity o1;
    SecondEntity o2;
}
```
### Dobrze
```
public class ProductWithCategory {
    Product product;
    Category category;
}
```

---
## Nazwy kontekstowe

### Źle
```
class Address {
    String addressCity;
    String addressHomeNumber;
    String addressPostalCode;
}
```

---
## Nazwy kontekstowe

### Źle
```
class Address {
    String addressCity;
    String addressHomeNumber;
    String addressPostalCode;
}
```
### Dobrze
```
class Address {
    String city;
    String homeNumber;
    String postalCode;
}
```
---
## Nazwy możliwie szczegółowe

## Żle
```
class CarManager {
    void get(Car car){...}; // rent
    void put(Car car){...}; // return
}

```
---
## Nazwy możliwie szczegółowe

## Żle
```
class CarManager {
    void get(Car car){...};
    void put(Car car){...};
}

```
## Dobrze
```
class CarRental {
    void rent(Car car){...};
    void giveCarBack(Car car){...};
}

```
---
layout: false
class: center middle

## Ćwiczenia - wprowadzenie

---
## Ćwiczenia - wprowadzenie

W pakiecie `com.inqoo.quality.clean.library.exercises` znajdziecie prosty program zarządzające biblioteką.

Pracowała nad nim wynajęta firma outsourcingowa, która wbrew umowia dostarczyła <s>zasoby</s> ludzi z niżyszmi niż ustalone kompetencjami.
Zamiast seniora i regulara, było 1/8 regulara oraz 1 i 7/8 juniora po stawce _blended_ .

Ze względu na RODO nie wiemy nawet w jakim kraju to powstawało i chyba wolimy nie wiedzieć. Domena w historii gita wywołała lekkie
przerażenie u _solution architecta_.

W ocenie wynajętej firmy konsultingowej z Lublina kod jest bardzo słabej jakości i klient może zakwestionować te prace.
Konsultantom udało się napisać testy, potem skończył się budżet na ich usługi.

Prawnicy pracują nad pozwem, ale proces nie ruszy przed deadlinem o wyroku nie wspominając.

No - musicie to wyprostować.

---
layout: false
class: center middle

## Nazwy - ćwiczenia

---
## Ćwiczenie

Zacznijmy od klasy `LibraryManager`.

Jest to punkt wejścia do całego modułu - czyli jedyna klasa publiczna w tym pakiecie. To jej metody będą wywoływać aplikacje
mobilne czytelniczek oraz czytelników i _backoffice_ bibliotekarek oraz bibliotekarzy.

Z raportu konsultantów wynika, że w tej klasie bezwzględnie trzeba poprawić nazwy:
- samej klasy `LibraryManager`
- pól tej klasy
- metod klasy `LibraryManager`
- klas do których `LibraryManager` się odnosi
- metod klas do których `LibraryManager` się odnosi

Wskazówki

- W IntelliJ IDEA nazwy można zmienić skrótem Shift+F6
- Pamiętajcie o wykonaniu testów po każdej zmianie

---
layout: false
class: center middle

## Nazwy - podsumowanie
---
layout: false
class: center middle

## Budowa funkcji (metod)
---
## Po czym poznać dobrą metodę?

Krótka

Mało wcięć

Robi jedną rzecz

Mało paramterów

---

## Jak pracować z metodami?

Podział metody na mniejsze

Grupowanie parametrów w klasy

Podejście top-bottom, od najbardziej ogólnych do najbardziej szczegółowych

Nie zwracamy `null`
---

## Warunki logiczne

Opakowywać złożone warunki logiczne w metody prywatne

Przy każdym `if` musi być nawias `{`

W kaskadzie `if` warto spróbować zrozumieć (nawet narysować) warunki - może warto to przearanżować

---
layout: false
class: center middle

## Metody - przykład

Wróćmy do naszego kalkulatora podatkowego

---
layout: false
class: center middle

## Metody - ćwiczenie
---
## Metody - ćwiczenie

Czas na ciąg dalszy pracy nad naszą biblioteką. W pakiecie `com.inqoo.quality.clean.library.exercise` znajdziesz klasę
z komentarzem

` // TODO: clean up methods `

Ona również przykuła uwagę naszych konsultantów i na pewno przykuje uwagę audytorów przy przekazywaniu projektu.

Zwróćcie uwagę na metody. Są one bardzo skomplikowane i nieczytelne. O dziwo nazewnictwo jest na niezłym poziomie,
prawdopodobnie pisał to ten regular developer na 1/8 etatu.

Pamiętajcie o testach!

---
layout: false
class: center middle

## Metody - podsumowanie

---
layout: false
class: center middle

## Klasy

---
## Cechy dobrej klasy

Krótka

Spójna

Skupiona na zbliżonych zadaniach

---
## Heurystyki związane z klasami

SOLID

Prawo Demeter

---
## SOLID

SRP - Single Responsibility Principle

OCP - Open-Closed Principle

LSP - Liskov Substitution Principle

ISP - Interface Seperation Principle

DIP - Dependency Inversion Principle

---
## SRP - Single Responsibility Principle

Klasa ma

> - pojedynczą odpowiedzialność

> - jeden powód do zmiany

no, generalnie robi jedną rzecz
---
## SRP - Single Responsibility Principle

"Robi jedną rzecz", czyli np.:

Oblicza podatek

Wypożycza książki

Jest katalogiem klientów

Przeprowadza operacje odczytu/zapisu/modyfikacji na bazie danych

Wywołuje inne metody na innej klasie

---
## SRP - przykłady
```
public class Library {
    private final Books books;
    private final ReadersRegister readersRegister;
    private final BookBorrow bookBorrow;

    void addBook(Book book) {
        books.addBook(book);
    }
    int availableCopies(Book book) {
        return books.availableCopies(book);
    }
    void enroll(Reader reader) {
        readersRegister.enroll(reader);
    }
    List<Reader> enrolledReaders() {
        return readersRegister.readers();
    }
    BorrowOutcome bookRental(Book book, Reader reader) {
        return bookBorrow.bookRental(book, reader);
    }
    ReturnOutcome giveBack(Book book, Reader reader) {
        return bookBorrow.giveBack(book, reader);
    }
}

```
---
## SRP - przykłady
```
class BookBorrow {
    private final Books books;
    private final ReadersRegister readersRegister;
    private final BorrowedBooksRegistry borrowedBooksRegistry;

    BorrowOutcome bookRental(Book book, Reader reader) {...}
    private boolean readerAlreadyBorrowedTheBook(Book book, Reader reader) {...}
    private boolean noBookCopiesAvailable(Book book) {...}
    private boolean bookNotInCatalogue(Book book) {...}
    private boolean readerNotEnrolled(Reader reader) {...}

    ReturnOutcome giveBack(Book book, Reader reader) {...}
    private boolean bookIsNotBorrowedByReader(Book book, Reader reader) {...}
}
```
---
## OCP - Open-Closed Principle

Otwarta na rozszerzenia - zamknięta na modyfikacje

---
## OCP - przykład
```
// only readers related code
public class Library {
    private final List<Reader> readers;

    void enroll(Reader reader) {
        readers.add(reader);
    }

    List<Reader> enrolledReaders() {
        return unmodifiableList(readers);
    }
}
```
Co jeśli będziemy chcieli zmienić to na `Set<Reader>`?
Albo na `Map`?
Albo na bazę danych?
Albo na plik?

---
## OCP - przykład lepszy
```
public class Library {
    private final ReadersRegister readersRegister;

    void enroll(Reader reader) {readersRegister.enroll(reader);}

    List<Reader> enrolledReaders() {return readersRegister.readers();}
}

class ReadersRegister {
    private final List<Reader> readers;

    void enroll(Reader reader) {readers.add(reader);}
    List<Reader> readers() {return unmodifiableList(readers);}
}
```
Lepiej, ale trzeba będzie zmienić `ReadersRegister`
---
## OCP - przykład jeszcze lepszy
```
public class Library {
    private final ReadersRegister readersRegister;

    void enroll(Reader reader) {readersRegister.enroll(reader);}
    List<Reader> enrolledReaders() {return readersRegister.readers();}
}

interface ReadersRegister {
    void enroll(Reader reader);
    List<Reader> readers();
}

class InMemoryReadersRegister implements ReadersRegister {
    private final List<Reader> readers;

    void enroll(Reader reader) {readers.add(reader);}
    List<Reader> readers() {return unmodifiableList(readers);}
    boolean contains(Reader reader) {return readers.contains(reader);}
}
```

W razie potrzeby dokładamy nową implementację interfejsu

Nowa implementacja interfejsu - rozszerzenie

Brak modyfikacji istniejącego kodu, lub minimalna zmiana konfiguracji.

---
## LSP - Liskov Substitution Principle

Przy wymianie różnych implementacji interfejsu system zachowuje się tak samo

---
## LSP - przykłady

Czym się charakteryzuje  `List<>` ?

---
## LSP - przykłady

Czym się charakteryzuje  `List<>` ?

Elementy mogą się powtarzać

Elementy są wstawiane na koniec.

Tak działa `ArrayList<>` i `LinkedList<>`

---
## LSP - przykłady

Co jesli napiszemy własną implementację listy której:

Elementy będą mogły się powtarzać?

Będzie dodawać elementy na początek?

Niespełniony kontrakt, testy nie przejdą - złamana LSP!

---
## ISP - Interface Seperation Principle

Do użytkownika/klienta danego interfejsu dostępne jest tylko to z czego korzysta
---
## ISP - przykład
```
public class Library implements BookFacade, ReaderFacade {
    public void addBook(Book book){...}
    public void addBooks(Book book, int amount){...}
    public int availableCopies(Book book){...}
    public Set<Book> bookCatalogue(){...}
    public void enroll(Reader reader){...}
    public List<Reader> enrolledReaders(){...}
    public BorrowOutcome bookRental(Book book, Reader reader){...}
    public ReturnOutcome giveBack(Book book, Reader reader){...}
}
```

Z czym są związane te metody?
---
## ISP - przykład
```
public interface BookFacade {
    void addBook(Book book);
    void addBooks(Book book, int amount);
    int availableCopies(Book book);
    Set<Book> bookCatalogue();
    BorrowOutcome bookRental(Book book, Reader reader);
    ReturnOutcome giveBack(Book book, Reader reader);
}
```
```
public interface ReaderFacade {
    void enroll(Reader reader);
    List<Reader> enrolledReaders();
}

```
```
public class Library implements BookFacade, ReaderFacade{...}
```
---
## DIP - Dependency Inversion Principle

Moduły wysokiego poziomu nie powinny zależeć od modułów niskiego poziomu. Oba powinny zależeć od abstrakcji.

Abstrakcje nie powinny zależeć od detali. Detale powinny zależeć od abstrakcji.

"Zależy" = kod zależy do tego do czego ma referencję, używa.
---
## DIP - przykład

Podobnie jak OCP, ale inaczej

```
// only readers related code
public class Library {
    private final List<Reader> readers;

    void enroll(Reader reader) {
        readers.add(reader);
    }

    List<Reader> enrolledReaders() {
        return unmodifiableList(readers);
    }
}
```
`Library` zależy bezpośrednio od `List`, która udaje bazę danych.

Dlaczego to może być problem?
---
## DIP - przykład lepszy
```
public class Library {
    private final ReadersRegister readersRegister;

    void enroll(Reader reader) {readersRegister.enroll(reader);}

    List<Reader> enrolledReaders() {return readersRegister.readers();}
}

class ReadersRegister {
    private final List<Reader> readers;

    void enroll(Reader reader) {readers.add(reader);}
    List<Reader> readers() {return unmodifiableList(readers);}
}
```
Co tu zależy od czego?

Od czego zależy `Library`?

Co zależy od `ReadersRegister`?

---
## DIP - przykład jeszcze lepszy
```
public class Library {
    private final ReadersRegister readersRegister;

    void enroll(Reader reader) {readersRegister.enroll(reader);}
    List<Reader> enrolledReaders() {return readersRegister.readers();}
}

interface ReadersRegister {
    void enroll(Reader reader);
    List<Reader> readers();
}

class InMemoryReadersRegister implements ReadersRegister {
    private final List<Reader> readers;

    void enroll(Reader reader) {readers.add(reader);}
    List<Reader> readers() {return unmodifiableList(readers);}
    boolean contains(Reader reader) {return readers.contains(reader);}
}
```
Od czego zależy `Library` teraz?

Od czego zależy `InMemoryReadersRegister`?

---
layout: false
class: center middle

## Prawo Demeter

---

## Prawo Demeter

Nie rozmawiaj z nieznajomymi

---

## Prawo Demeter bardziej formalnie

Metoda danego obiektu może odwoływać się jedynie do metod należących do:

- tego samego obiektu
- dowolnego parametru przekazanego do niej
- dowolnego obiektu przez nią stworzonego
- dowolnego składnika klasy, do której należy dana metoda

---

## Prawo Demeter - przykład

### Żle
Antywzorzec Train wreck
```
    crocodile.getStomach().put(sausage);

```

---
## Prawo Demeter - przykład

### Żle

Antywzorzec Train wreck
```
    crocodile.getStomach().put(sausage);

```
### Dobrze

```
    crocodile.feed(sausage);

    class Crocodile() {
        Stomach stomach;
        feed(Food food) {
            stomach.put(food);
        }
    }


```
---
## Prawo Demeter - WAŻNE

Tzw. fluent API, np. Stream nie łamie tej zasady

```
List.of(1, -1, 2, -3)
    .stream()
    .filter(item -> item < 0)
    .map(item -> new String(item)
    .collect(toList())
```

Nie rozkładamy tu niczego na czynniki pierwsze, każde wywołanie zwraca nam nowy obiekt.

---
layout: false
class: center middle

## Klasy - ćwiczenie

---

## Klasy - ćwiczenie

Wróćmy do naszej biblioteki.

Ostatnim punktem w raporcie doradców był fatalny stan klasy z komentarzem

`// TODO: class cleanup`.

Klasa ta teoretycznie powinna zarządzać katalogiem książek oraz ich magazynem.

Robi to, niestety łamie przy tym kilka omówionych przed chwilą dobrych praktyk, co klient na pewno wytknie przy odbiorze aplikacji.

Musisz zacząć działać.


---
layout: false
class: center middle

## Klasy - podsumowanie

---
layout: false
class: center middle

## Komentarze

---
## Komentarze

Nie powinny zastępować czytelnych nazw w kodzie

Kod wymagający komentarzy jest jak dowcip wymagający tłumaczenia

Powinny wyjaśniać rozumowanie za "dziwnym" miejscem w kodzie

---
layout: false
class: center middle

## Formatowanie

---
## Formatowanie

Używajmy importów statycznych, jeśli to poprawi czytelność kodu

Pola i metody statyczne na górze klasy

Pola klasy

Konstruktory

Metody

---
layout: false
class: center middle

## Czysty kod - podsumowanie

---
layout: false
class: center middle

## Czysty kod - podsumowanie
Wasze wnioski, uwagi, spostrzeżenia?

---

## Czysty kod - podsumowanie

Odpowiadamy za to wszyscy

Wszyscy musimy żyć ze złym kodem

"Wybita szyba"

"Boy Scout Rule"

Refaktoryzacja

---
layout: false
class: center middle

## Boy Scout Rule

Leave your code better than you found it

---
layout: false
class: center middle

## Boy Scout Rule

Leave your code better than you found it

(but not build national park around it)

---
layout: false
class: center middle

## Refaktoryzacja

ulepszanie struktury istniejącego kodu, bez zmiany jego zachowania

---
## Techniki refaktoryzacji (niektóre :) )

Zmiana nazwy zmiennej

Ekstrakcja metody

Ekstrakcja klasy

---
layout: false
class: center middle

## Zespołowość

---

## Zespołowość

Nie pracujemy w próżni

Odpowiadamy za całość jako zespół!

---

## Programowanie w parach/w tłumie

Cel: natychmiastowa informacja zwrotna o jakości kodu

Jeden robi jak się patrzy, reszta patrzy jak się robi

Częste zmiany ról

---

## Przeglądanie kodu (code review)

Cele:

- informacja zwrotna o jakości kodu

- komunikacja w zespole

---
layout: false
class: center middle

## TDD
---
layout: false
background-image: url(tdd_flow.gif)
background-size: contain
background-repeat: no-repeat
background-position: bottom
class: center top
---
## Dlaczego TDD?

_Fail_ testu na początku cyklu gwarantuje że nie przetestujemy przez przypadek nie tego co trzeba

Wcielamy się w rolę użytkownika naszego kodu

Narzuca dyscyplinę małych, metodycznych kroków

Krok _refactor_ zmusza do troski o jakość kodu

Działa! Są na to badania

---
## Budowa testu

Given

> Przygotowanie testu

When

> Wykonanie operacji, której wynik chcemy sprawdzić

Then

> Sprawdzamy wynik tego co testujemy

---
## Jakośc kodu testowego

Powinna być jak najwyższa

Testy to nie jest kod drugiej kategorii

Testy to także dokumentacja

---
## Test fixtures

Klasy odpowiedzialne za przygotowanie danych testowych

```
class BookFixture {
    Book paleBlueDot() {
        return new Book(ISBN.of("0-679-43841-6"), "Carl Sagan", "Pale Blue Dot");
    }

    Book cleanCode() {
        return new Book(ISBN.of("978-0132350884"), "Robert C. Martin", "Clean Code");
    }
}
```

---
## Assertions

Do opakowywanie asercji można użyć metod prywatnych, by poprawić czytelność. Np.:
```
assertThat(result).isTrue()
```

Można wyrazić

```
assertThatOperationIsSuccessful()
...

void assertThatOperationIsSuccessful() {
    assertThat(result).isTrue()
}
```

---
layout: false
class: center middle

## TDD - String Calculator

---
## TDD - String Calculator - krok 1

Utwórz klasę StringCalculator z metodą

```
String add(String numbers)
```
Metoda przyjmuje do dwóch liczb oddzielonych przecinkami i zwraca ich sumę,

np. `""`, `"1"`, `"1,2"`

Pusty napis zwraca 0.

---
## TDD - String Calculator - krok 2

Metoda `add` powinna obsługiwać dowolną liczbę liczb

Np. `"1,2,3"` zwraca 6
---
## TDD - String Calculator - krok 3

Metoda `add` powinna przyjmować znak nowej linii zamiast przecinka:

Np. sekwencja `"1\n2,3"` jest poprawna i zwraca 6

Celem wyjaśnienia:`"1,\n"` nie jest poprawna
---
## TDD - String Calculator - krok 4

Wspieraj różne rozgraniczniki, nie tylko przecinek

By zmienić znak rozgraniczający na początku napisu będzie umieszczona linia postaci

`"//[delimiter]\n[numbers…]"`

np. `"//;\n1;2"`
zwróci 3

a znak rozgraniczający to `";"`

Pierwsza linia jest opcjonalna. Wszystkie poprzednie scenariusze mają działać.

---
## TDD - String Calculator - krok 5

Wywołanie dodawania z liczbą ujemną powinno wyrzucić wyjątek z wiadomością "negatives not allowed" i liczbami ujemnymi, które spowodowały błąd.

Jeśli liczb ujemnych jest więcej pokaż jest wszystkie

---
## TDD - String Calculator - krok 6

Liczby większe niż 1000 powinny być ignorowane, czyli:

`2 + 1001 = 2`

---
## TDD - String Calculator - krok 7

Rozgraniczniki mogą być dowolnej długości

`"//[delimiter]\n"`

na przykład:

`"//[***]\n1***2***3"`

daje w wyniku 6.

---
## TDD - String Calculator - krok 8

Można użyć wielu rozgraniczników:

`"//[delim1][delim2]\n"`

na przykład

`"//[*][%]\n1*2%3"`

daje w wyniku 6.

---
## TDD - String Calculator - krok 9

Zapewnij że program wspiera wiele wieloznakowych rozgraniczników

---
layout: false
class: center middle

## TDD - podsumowanie

---
layout: false
class: center middle

## Vending machine

---
## Object callisthenics

Only One Level Of Indentation Per Method

Don’t Use The ELSE Keyword

Wrap All Primitives And Strings

First Class Collections

One Dot Per Line

Don’t Abbreviate

Keep All Entities Small

No Classes With More Than Two Instance Variables

No Getters/Setters/Properties

---

## One Level Of Indentation Per Method
```
    public String board() {
        StringBuilder buf = new StringBuilder();
        for (int i = 0; i < 10; i++) {
            for (int j = 0; j < 10; j++) {
                buf.append(data[i][j]);
            }
            buf.append("\n");
        }
        return buf.toString();
    }
```
---

## One Level Of Indentation Per Method

```
    public String board() {
        StringBuilder buf = new StringBuilder();
        collectRows(buf);
        return buf.toString();
    }

    private void collectRows(StringBuilder buf) {
        for (int i = 0; i < 10; i++) {
            collectRow(buf, i);
        }
    }

    private void collectRow(StringBuilder buf, int row) {
        for (int i = 0; i < 10; i++) {
            buf.append(data[row][i]);
        }
        buf.append("\n");
    }
```
---
## Don’t Use The ELSE Keyword
```
public AuthResult login(String username, String password) {
    if (userRepository.isValid(username, password)) {
        return AuthResult.SUCCESS;
    } else {
        return AuthRestult.FAILURE;
    }
}
```
---
## Don’t Use The ELSE Keyword
```
public AuthResult login(String username, String password) {
    if (userRepository.isValid(username, password)) {
        return AuthResult.SUCCESS;
    }
    return AuthRestult.FAILURE;
}
```
lub
```
public AuthResult login(String username, String password) {
    return userRepository.isValid(username, password)
        ? AuthResult.SUCCESS;
        : AuthRestult.FAILURE;
}
```


---
## Wrap All Primitives And Strings
```
class ISBN {
    static ISBN of(String rawIsbn) {
        return new ISBN(rawIsbn);
    }

    private final String raw;

    private ISBN(String raw) {
        this.raw = raw;
    }
}
```
---
## First Class Collections
```
class MyClass {
    List<Book> books = new ArrayList<>();
}
```
---
## First Class Collections
```
class Books {
    List<Book> books = new ArrayList<>();

    void Add() {
        books.add(book);
    }
}
```
---
## One Dot Per Line

prawo Demeter
```
    crocodile.getStomach().put(sausage);

```

---
## One Dot Per Line

```
    crocodile.feed(sausage);

    class Crocodile() {
        Stomach stomach;
        feed(Food food) {
            stomach.put(food);
        }
    }

```

---
## Don’t Abbreviate

Just no

---
## Keep All Entities Small

No class over 50 lines
---
## Max Two Fields Per Class

That's quite obvious
---
## No Getters/Setters/Properties

That's quite obvious

---
## Vending machine - feature 1

The vending machine will accept valid coins (nickels, dimes, and quarters) and reject invalid ones (pennies).

When a valid coin is inserted the amount of the coin will be added to the current amount and the display will be updated.

When there are no coins inserted, the machine displays INSERT COIN. Rejected coins are placed in the coin return.

---
## Vending machine - feature 2

There are three products: cola for $1.00, chips for $0.50, and candy for $0.65.

When the respective button is pressed and enough money has been inserted, the product is dispensed and the machine displays THANK YOU.

When product is collected, it will display INSERT COIN and the current amount will be set to $0.00.

If there is not enough money inserted then the machine displays INSERT COIN and PRICE and the price of the item.

---
## Vending machine - feature 3

When a product is selected that costs less than the amount of money in the machine, then the remaining amount is placed in the coin return.

---
## Vending machine - feature 4

When the "return coins" button is pressed, the money the customer has placed in the machine is returned and the display shows INSERT COIN.

---
## Vending machine - feature 5

When the item selected by the customer is out of stock, the machine displays SOLD OUT and return money.

---
## Vending machine - feature 6

When the machine is not able to make change with the money in the machine for any of the items that it sells,
it will display EXACT CHANGE ONLY instead of INSERT COIN.

---
layout: false
class: center middle

## Warsztat - podsumowanie
---
layout: false
class: center middle

## Rozwój własny


---
## Jak się tego uczyć?

Programować, programować, programować

Czytać, czytać, słuchać, oglądać

---
layout: false
class: center middle

## Projekt do domu

---
## Sudoku

Gra polega na wypełnieniu planszy cyframi od 1 do 9 w ten sposób, aby
- w tym samym wierszu,
- w tej samej kolumnie,
- oraz w każdym sektorze 3×3 oznaczonym pogrubiona linią,
znajdowała się tylko jedna taka sama cyfra.

Innymi słowy w żadnej kolumnie, wierszu, lub oznaczonym sektorze nie może powtórzyć się dwa razy ta sama cyfra.

---
layout: false
background-image: url(sudoku.gif)
background-size: contain
background-repeat: no-repeat
background-position: bottom
class: center top
---
## Sudoku

Trzymamy się:

TDD

Object Callisthenics

---
## Materiały dodatkowe

TDD by Example - Kent Beck

Czysty Kod - Robert C. Margin

Ola Kunysz - Tydzień z TDD (youtube)

Sandro Mancuso - Mars Rover (youtube)

Krzysztof Szabelski - Pair programming pragmatycznie (youtube)

Sebastian Malaca - Code review jak robić to lepiej? (youtube)

---

class: center middle

# Thank you!

</textarea>
<script src="https://gnab.github.io/remark/downloads/remark-latest.min.js" type="text/javascript"></script>
<script type="text/javascript">
      var slideshow = remark.create({
        countIncrementalSlides: false
      });
    </script>
</body>
</html>